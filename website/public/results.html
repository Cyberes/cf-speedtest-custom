<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Results - Last 100 Speedtests</title>
<link href="/bootstrap.css" rel="stylesheet" />
</head>
<body class="bg-light">
<div class="container py-4">
	<div class="d-flex justify-content-between align-items-center mb-4">
		<h1 class="h2 mb-0">Results</h1>
		<a href="/" class="btn btn-outline-primary">Back to Speedtest</a>
	</div>
	<div id="tableWrap"></div>
</div>
<script>
(function() {
  function el(tag, attrs, children) {
    var e = document.createElement(tag);
    if (attrs) for (var k in attrs) e.setAttribute(k, attrs[k]);
    if (children) children.forEach(function(c) {
      e.appendChild(typeof c === 'string' ? document.createTextNode(c) : c);
    });
    return e;
  }
  fetch('/results/data', { credentials: 'include' })
    .then(function(r) {
      if (!r.ok) throw new Error(r.status + ' ' + r.statusText);
      return r.text();
    })
    .then(function(text) {
      var rows = [];
      var hideIps = false;
      if (text && text.trim()) {
        try {
          var data = JSON.parse(text);
          if (Array.isArray(data)) { rows = data; }
          else { rows = data.results || []; hideIps = data.hide_ips === true; }
        } catch (e) { rows = []; }
      }
      if (!Array.isArray(rows)) rows = [];
      var wrap = document.getElementById('tableWrap');
      if (rows.length === 0) {
        wrap.innerHTML = '<div class="alert alert-info">No results yet. Complete a speedtest on the <a href="/" class="alert-link">main page</a>; results are saved when the test finishes.</div>';
        return;
      }
      var card = el('div', { 'class': 'card shadow-sm' });
      var cardBody = el('div', { 'class': 'card-body p-0' });
      var table = el('table', { 'class': 'table table-striped table-hover mb-0' });
      var thead = el('thead', { 'class': 'table-light' });
      var tr = el('tr', {}, []);
      var hdrs = hideIps ? ['Time', 'Download (Mbps)', 'Upload (Mbps)', 'Ping (ms)', 'Jitter (ms)'] : ['IP', 'Time', 'Download (Mbps)', 'Upload (Mbps)', 'Ping (ms)', 'Jitter (ms)'];
      hdrs.forEach(function(h) { tr.appendChild(el('th', { 'scope': 'col' }, [h])); });
      thead.appendChild(tr);
      table.appendChild(thead);
      var tbody = el('tbody');
      rows.forEach(function(row) {
        var rowEl = el('tr', {}, []);
        var cells = hideIps ? [row.timestamp_iso || '', row.dl_mbps || '', row.ul_mbps || '', row.ping_ms || '', row.jitter_ms || ''] : [row.ip || '', row.timestamp_iso || '', row.dl_mbps || '', row.ul_mbps || '', row.ping_ms || '', row.jitter_ms || ''];
        cells.forEach(function(val) { rowEl.appendChild(el('td', {}, [val])); });
        tbody.appendChild(rowEl);
      });
      table.appendChild(tbody);
      cardBody.appendChild(table);
      card.appendChild(cardBody);
      wrap.appendChild(card);
    })
    .catch(function(err) {
      var msg = 'Failed to load: ' + err.message + '. If you use a password, log in as admin.';
      document.getElementById('tableWrap').innerHTML = '<div class="alert alert-danger">' + msg + '<\/div>';
    });
})();
</script>
</body>
</html>
